

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Methodology &mdash; hplc-py 0.2.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=f553e99a" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=37f418d5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #3C3E47" >

          
          
          <a href="../index.html">
            
              <img src="../_static/logo_horizontal-02.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/calibration_curve.html">Absolute Quantitation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How It Works</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../methodology/problem.html">The Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methodology/baseline.html">Step 1: Baseline Correction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methodology/peak_detection.html">Step 2: Detecting Peaks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methodology/fitting.html">Step 3: Fitting Peaks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../methodology/scoring.html">Step 4: Scoring the Reconstruction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quant.html"><cite>hplc.quant</cite></a></li>
<li class="toctree-l1"><a class="reference internal" href="../io.html"><cite>hplc.io</cite></a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Credit &amp; Citation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../citation.html">Credit</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #3C3E47" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">hplc-py</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Methodology</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/getting_started/algorithm.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Methodology">
<h1>Methodology<a class="headerlink" href="#Methodology" title="Link to this heading"></a></h1>
<p><strong>Note: This notebook is under active development and will change a lot.</strong></p>
<section id="The-Problem">
<h2>The Problem<a class="headerlink" href="#The-Problem" title="Link to this heading"></a></h2>
<p><strong>H</strong>igh-<strong>P</strong>erformance <strong>L</strong>iquid <strong>C</strong>hromatography (HPLC) is an analytical technique which allows for the quantitative characterization of the chemical components of a mixture. While many of the technical details of HPLC are now automated, the programmatic cleaning and processing of the resulting data can be cumbersome and often requires extensive manual labor.</p>
<p>Consider a scenario where you have an environmental sample that contains several different chemical species. Through the principle of <a class="reference external" href="https://en.wikipedia.org/wiki/Chromatography">chromatographic separation</a>, you use an HPLC instrument to decompose the sample into its constituents by measuring the time it takes for each analyte to pass through the column. The resulting data is a chromatogram, which may look something like this</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>

<span class="c1"># Load the measurement</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;./data/sample_chromatogram.txt&#39;</span><span class="p">)</span>

<span class="c1"># Plot the chromatogram</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time_min&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;intensity_mV&#39;</span><span class="p">],</span> <span class="s1">&#39;k-&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time [min]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;signal [mV]&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;signal [mV]&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/getting_started_algorithm_1_1.png" src="../_images/getting_started_algorithm_1_1.png" />
</div>
</div>
<p>By eye, it looks like there may be six individual compounds in the sample. Some are isolated (e.g., the peak at 11 min) while others are severely overlapping (e.g. the peaks from 13-15 min). This indicates that some of the compounds have similar elution times through the column with this particular mobile phase.</p>
<p>While its easy for us to see these peaks, how do we quantify them? How can we tease apart peaks that are overlapping? This is easier to say than to do. There are several tools available to do this that are open source (such as <a class="reference external" href="https://github.com/Tarskin/HappyTools">HappyTools</a>) or proprietary (such as <a class="reference external" href="https://www.thermofisher.com/order/catalog/product/CHROMELEON7">Chromeleon</a>). However, in many cases peaks are quantified simply but integrating only the non-overlapping regions.</p>
<p>Hplc-Py, however, fits mixtures of skewnormal distributions to regions of the chromatogram that contain either singular or highly overlapping peaks, allowing one to go from the chromatogram above to a decomposed mixture in a few lines of Python code.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Show the power of hplc-py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hplc.quant</span>
<span class="n">chrom</span> <span class="o">=</span> <span class="n">hplc</span><span class="o">.</span><span class="n">quant</span><span class="o">.</span><span class="n">Chromatogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;time&#39;</span><span class="p">:</span><span class="s1">&#39;time_min&#39;</span><span class="p">,</span> <span class="s1">&#39;signal&#39;</span><span class="p">:</span><span class="s1">&#39;intensity_mV&#39;</span><span class="p">})</span>
<span class="n">peaks</span> <span class="o">=</span> <span class="n">chrom</span><span class="o">.</span><span class="n">fit_peaks</span><span class="p">()</span>

<span class="c1"># Display the results</span>
<span class="n">chrom</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">time_range</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
<span class="n">peaks</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Performing baseline correction: 100%|██████████| 299/299 [00:00&lt;00:00, 663.24it/s]
Deconvolving mixture: 100%|██████████| 3/3 [00:08&lt;00:00,  2.96s/it]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>retention_time</th>
      <th>scale</th>
      <th>skew</th>
      <th>amplitude</th>
      <th>area</th>
      <th>peak_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10.90</td>
      <td>0.157450</td>
      <td>0.674286</td>
      <td>23250.349387</td>
      <td>2.790042e+06</td>
      <td>1</td>
    </tr>
    <tr>
      <th>0</th>
      <td>13.17</td>
      <td>0.582866</td>
      <td>3.839860</td>
      <td>42250.783974</td>
      <td>5.070094e+06</td>
      <td>2</td>
    </tr>
    <tr>
      <th>0</th>
      <td>14.45</td>
      <td>0.353036</td>
      <td>-3.019153</td>
      <td>35229.583555</td>
      <td>4.227550e+06</td>
      <td>3</td>
    </tr>
    <tr>
      <th>0</th>
      <td>15.53</td>
      <td>0.312563</td>
      <td>1.630787</td>
      <td>14891.041452</td>
      <td>1.786925e+06</td>
      <td>4</td>
    </tr>
    <tr>
      <th>0</th>
      <td>16.52</td>
      <td>0.344266</td>
      <td>1.984167</td>
      <td>10770.656732</td>
      <td>1.292479e+06</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/getting_started_algorithm_3_2.png" src="../_images/getting_started_algorithm_3_2.png" />
</div>
</div>
<section id="How-It-Works">
<h3>How It Works<a class="headerlink" href="#How-It-Works" title="Link to this heading"></a></h3>
<p>The peak detection and quantification algorithm in <code class="docutils literal notranslate"><span class="pre">hplc-py</span></code> involves the following steps.</p>
<ol class="arabic simple">
<li><p>Estimation of signal background using <a class="reference external" href="https://doi.org/10.1366/000370208783412762">Statistical Nonlinear Iterative Peak (SNIP) estimation</a>.</p></li>
<li><p>Automatic detection of peak maxima given threshold criteria (such as peak prominence).</p></li>
<li><p>Clipping of the chromatogram into “peak windows” which contain at least one peak. Regions of the chromatogram which are stacked with heavily overlapping signals are grouped into single windows.</p></li>
<li><p>For a window with <span class="math notranslate nohighlight">\(N\)</span> peaks, a mixture of <span class="math notranslate nohighlight">\(N\)</span> skew-normal disttributions are inferred using the measured peak properties (such as location, maximum value, and width at half-maximum) are used as initial guesses. This inference is performed through an optimization by minimization procedure. This inference is repeated for each window in the chromatogram.</p></li>
<li><p>Given best-fit parameters for each distribution, the expected signal of the compound across the entire observation window is computed. The integrated signal over the entire peak is computed and stored.</p></li>
<li><p>The estimated mixture of all compounds is computed given the parameter estimates of each distribution.</p></li>
</ol>
<p>The rest of this notebook will examine in detail how each of these steps is implemented.</p>
<section id="Step-1:-Correcting-for-a-Drifting-Baseline">
<h4>Step 1: Correcting for a Drifting Baseline<a class="headerlink" href="#Step-1:-Correcting-for-a-Drifting-Baseline" title="Link to this heading"></a></h4>
</section>
<section id="Step-2:-Identification-of-Peak-Maxima-and-Including-Obscured-Peaks">
<h4>Step 2: Identification of Peak Maxima and Including Obscured Peaks<a class="headerlink" href="#Step-2:-Identification-of-Peak-Maxima-and-Including-Obscured-Peaks" title="Link to this heading"></a></h4>
</section>
<section id="Step-3:-Clipping-the-Chromatogram-Into-Windows">
<h4>Step 3: Clipping the Chromatogram Into Windows<a class="headerlink" href="#Step-3:-Clipping-the-Chromatogram-Into-Windows" title="Link to this heading"></a></h4>
</section>
<section id="Step-4:-Per-Window-Estimation-of-Constituent-Signals">
<h4>Step 4: Per-Window Estimation of Constituent Signals<a class="headerlink" href="#Step-4:-Per-Window-Estimation-of-Constituent-Signals" title="Link to this heading"></a></h4>
</section>
<section id="Steps-5-&amp;-6:-Integration-of-Signal-and-Evaluating-Composition-of-Mixture">
<h4>Steps 5 &amp; 6: Integration of Signal and Evaluating Composition of Mixture<a class="headerlink" href="#Steps-5-&-6:-Integration-of-Signal-and-Evaluating-Composition-of-Mixture" title="Link to this heading"></a></h4>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Griffin Chure &amp; Jonas Cremer.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>